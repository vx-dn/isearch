# GitHub Secrets Setup Guide

This document explains how to set up the required GitHub secrets for the infrastructure deployment workflow.

## Required Secrets

### AWS OIDC Role ARNs
These are required for authenticating with AWS using OIDC (OpenID Connect):

- `AWS_ROLE_ARN_DEV` - ARN of the IAM role for development environment
- `AWS_ROLE_ARN_STAGING` - ARN of the IAM role for staging environment  
- `AWS_ROLE_ARN_PROD` - ARN of the IAM role for production environment

**Format:** `arn:aws:iam::123456789012:role/GitHubActions-Infrastructure-{environment}`

### Meilisearch Master Keys
These are the master keys for Meilisearch authentication:

- `MEILISEARCH_MASTER_KEY_DEV` - Master key for development Meilisearch instance
- `MEILISEARCH_MASTER_KEY_STAGING` - Master key for staging Meilisearch instance
- `MEILISEARCH_MASTER_KEY_PROD` - Master key for production Meilisearch instance

**Format:** Secure random string (e.g., generated by `openssl rand -base64 32`)

## How to Add Secrets

1. Go to your repository on GitHub
2. Navigate to **Settings > Secrets and variables > Actions**
3. Click **New repository secret**
4. Add each secret with the exact name and value

## Security Notes

- **Never commit sensitive values to git** - they belong in GitHub secrets only
- Use different keys for each environment
- Production keys should be especially secure and rotated regularly
- Consider using environment-specific secrets for additional protection

## Environment Files

Non-sensitive configuration is stored in committed tfvars files:
- `infrastructure/terraform/environments/dev.tfvars`
- `infrastructure/terraform/environments/staging.tfvars`
- `infrastructure/terraform/environments/prod.tfvars`

These files contain public configuration like quotas, domain prefixes, and tags, but **never** contain sensitive values like keys or passwords.

## Workflow Usage

The infrastructure deployment workflow automatically:
1. Loads the appropriate tfvars file for the target environment
2. Passes sensitive values via `TF_VAR_*` environment variables from GitHub secrets
3. Validates that required secrets are present before deployment

## Troubleshooting

If you see errors about missing secrets:
1. Verify the secret name matches exactly (case-sensitive)
2. Check that the secret is set at the repository level (not organization-only)
3. Ensure you have the required permissions to access secrets
4. Use the test-oidc.yml workflow to debug OIDC authentication issues